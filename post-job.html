<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post a Job - JobConnect</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                JobConnect
            </a>
            <div class="nav-links">
                <a href="index.html">Find Jobs</a>
                <a href="post-job.html">Post a Job</a>
            </div>
            <div class="nav-auth" id="auth-container">
                <a href="login.html" class="btn btn-secondary">Login</a>
                <a href="register.html" class="btn btn-primary">Sign Up</a>
            </div>
        </div>
    </nav>

    <!-- Post Job Form -->
    <div class="form-container" style="max-width: 600px;">
        <h2>Post a New Job</h2>
        <form onsubmit="postJob(event)" id="post-job-form">
            <div class="form-group">
                <label for="title">Job Title *</label>
                <input type="text" id="title" name="title" placeholder="e.g., Junior Web Developer" required>
            </div>

            <div class="form-group">
                <label for="company">Company Name *</label>
                <input type="text" id="company" name="company" placeholder="Your company name" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="location">Location *</label>
                    <input type="text" id="location" name="location" placeholder="e.g., New York, NY or Remote"
                        required>
                </div>
                <div class="form-group">
                    <label for="job_type">Job Type *</label>
                    <select id="job_type" name="job_type" required>
                        <option value="full-time">Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="internship">Internship</option>
                        <option value="contract">Contract</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="salary_min">Min Salary ($/year)</label>
                    <input type="number" id="salary_min" name="salary_min" placeholder="e.g., 40000">
                </div>
                <div class="form-group">
                    <label for="salary_max">Max Salary ($/year)</label>
                    <input type="number" id="salary_max" name="salary_max" placeholder="e.g., 60000">
                </div>
            </div>

            <div class="form-group">
                <label for="description">Job Description *</label>
                <textarea id="description" name="description"
                    placeholder="Describe the role, responsibilities, and what makes this opportunity exciting..."
                    required style="min-height: 150px;"></textarea>
            </div>

            <div class="form-group">
                <label for="requirements">Requirements</label>
                <textarea id="requirements" name="requirements"
                    placeholder="List the skills, qualifications, and experience required (one per line)..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">Post Job</button>
        </form>
        <p class="form-footer">
            <a href="dashboard.html">‚Üê Back to Dashboard</a>
        </p>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // Wait for auth check
            setTimeout(async () => {
                if (!window.currentUser) {
                    Toast.show('Please login to post jobs', 'error');
                    setTimeout(() => window.location.href = 'login.html', 1500);
                    return;
                } else if (window.currentUser.role !== 'employer') {
                    Toast.show('Only employers can post jobs', 'error');
                    setTimeout(() => window.location.href = 'index.html', 1500);
                    return;
                }

                // Check for edit mode
                const urlParams = new URLSearchParams(window.location.search);
                const jobId = urlParams.get('id');

                if (jobId) {
                    document.querySelector('h2').textContent = 'Edit Job';
                    const form = document.getElementById('post-job-form');
                    const btn = form.querySelector('button[type="submit"]');
                    btn.textContent = 'Update Job';

                    // Add hidden ID field
                    const idInput = document.createElement('input');
                    idInput.type = 'hidden';
                    idInput.name = 'id';
                    idInput.value = jobId;
                    form.appendChild(idInput);

                    try {
                        const response = await ajax(`${API_BASE}/jobs.php?action=get&id=${jobId}`);
                        if (response.success) {
                            const job = response.data;
                            document.getElementById('title').value = job.title;
                            document.getElementById('company').value = job.company;
                            document.getElementById('location').value = job.location;
                            document.getElementById('job_type').value = job.job_type;
                            document.getElementById('salary_min').value = job.salary_min;
                            document.getElementById('salary_max').value = job.salary_max;
                            document.getElementById('description').value = job.description;
                            document.getElementById('requirements').value = job.requirements;
                        } else {
                            Toast.show('Job not found', 'error');
                        }
                    } catch (error) {
                        Toast.show('Failed to load job details', 'error');
                    }
                }
            }, 500);
        });
    </script>
</body>

</html>