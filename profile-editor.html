<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Profile - JobConnect</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                JobConnect
            </a>
            <div class="nav-links">
                <a href="index.html">Find Jobs</a>
                <a href="dashboard.html">Dashboard</a>
            </div>
            <div class="nav-auth" id="auth-container">
                <!-- Auth content loaded via JS -->
            </div>
        </div>
    </nav>

    <div class="form-container" style="max-width: 600px;">
        <h2>Manage Profile</h2>
        <form onsubmit="updateProfile(event)" id="profile-form">
            <div class="form-group">
                <label for="name">Full Name *</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" placeholder="+1 234 567 8900">
            </div>

            <div class="form-group">
                <label for="address">Location / Address</label>
                <input type="text" id="address" name="address" placeholder="City, Country">
            </div>

            <div class="form-group">
                <label for="bio">Bio</label>
                <textarea id="bio" name="bio" placeholder="Tell us about yourself..."
                    style="min-height: 100px;"></textarea>
            </div>

            <h3>Social Links</h3>

            <div class="form-group">
                <label for="website">Personal Website</label>
                <input type="url" id="website" name="website" placeholder="https://example.com">
            </div>

            <div class="form-group">
                <label for="github">GitHub URL</label>
                <input type="url" id="github" name="github" placeholder="https://github.com/username">
            </div>

            <div class="form-group">
                <label for="linkedin">LinkedIn URL</label>
                <input type="url" id="linkedin" name="linkedin" placeholder="https://linkedin.com/in/username">
            </div>

            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">Save Changes</button>
        </form>
        <p class="form-footer">
            <a href="profile.html">View Public Profile</a> | <a href="dashboard.html">Back to Dashboard</a>
        </p>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            setTimeout(async () => {
                if (!window.currentUser) {
                    window.location.href = 'login.html';
                    return;
                }

                // Load profile data
                try {
                    const response = await ajax(`${API_BASE}/profile.php?action=get`);
                    if (response.success) {
                        const user = response.data;
                        document.getElementById('name').value = user.name || '';
                        document.getElementById('phone').value = user.phone || '';
                        document.getElementById('address').value = user.address || '';
                        document.getElementById('bio').value = user.bio || '';
                        document.getElementById('website').value = user.website || '';
                        document.getElementById('github').value = user.github || '';
                        document.getElementById('linkedin').value = user.linkedin || '';
                    }
                } catch (error) {
                    Toast.show('Failed to load profile data', 'error');
                }
            }, 500);
        });

        async function updateProfile(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            formData.append('action', 'update');

            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            try {
                const response = await ajax(`${API_BASE}/profile.php`, 'POST', formData);
                if (response.success) {
                    Toast.show('Profile updated successfully!', 'success');
                } else {
                    Toast.show(response.message, 'error');
                }
            } catch (error) {
                Toast.show('Failed to update profile', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save Changes';
            }
        }
    </script>
</body>

</html>